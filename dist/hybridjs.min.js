!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HybridJS=t():e.HybridJS=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var o=n(2),i=r(o),a=i["default"];a.wrapAPI("app.listenMBack",function(){a.invokeApp("sdk.set_status",{key:"interceptOnBack",value:1})}),a.wrapAPI("app.cancelListenMBack",function(){a.invokeApp("sdk.set_status",{key:"interceptOnBack",value:0})}),a.wrapAPI("app.back",function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0];a.isInApp?a.invokeApp("sdk.back",{value:e}):window.history.back()}),a.wrapAPI("app.open",function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];a.isInApp?a.invokeApp("sdk.jump",{url:e,type:t}):location.href=e}),a.wrapAPI("app.set",function(e,t){a.invokeApp("sdk.set_status",{key:e,value:t})}),a.wrapAPI("app.get",function(e,t){a.invokeApp("sdk.get_status",{key:e,callback:t})}),i["default"].app.cancelListenMBack(),e.exports=a},function(e,t){"use strict";function n(e,t){if(/^web\./.test(e))throw new Error("此处不要使用`web`作为根命名空间");o(e,t)}function r(e,t){if(/^app\./.test(e))throw new Error("此处不要使用`app`作为根命名空间");o("web",e,t)}function o(e,t,n){arguments.length<3&&(n=arguments[1],t=arguments[0],e="");var r=t.split(/\./),o=r.pop();r[0]===e&&r.shift();var i=e?H[e]||(H[e]={}):H;i=s(i,r),o&&m(n)&&(i[o]=n)}function i(e,t){if(!e)return!1;t=m(t)?{callback:t}:t||{};var n=e.split(/\.|\//),r=n.pop(),o=t.callback,i=void 0,a=void 0;if(!n.length||!r)throw Error("api "+e+" has not assigned");a=n.join("/"),m(o)&&(i=l(e,o,t.context||H,void 0!==t.nextTick?t.nextTick:!0),delete t.callback,delete t.context,delete t.nextTick);var u=O+"://"+a+"/"+r+"?";return i&&(u+=E(J+"="+i+"&")),P in t&&(u+=E(P+"="+t[P]+"&"),delete t[P]),u+=E("value="+JSON.stringify(t)),v(u)}function a(e,t){if("string"!=typeof e||t&&"string"!=typeof t)throw Error("参数不合法，必须是字符串");if(t){t=decodeURIComponent(t);var n={};try{n=JSON.parse(t)}catch(r){if(/{/.test(t))throw r;n=null}var o=n?n[P]:null;if(o){var i=d(e,o);return delete n[P],void(m(i)&&i(n.value))}if(/^sdk(?:\.|\/)notify/.test(e)&&n){var a=n.value||{};return void c(a.event,a.data)}u(e,t,n)}else u(e)}function u(e,t,n){var r=e.split(/\.|\//);if(/window|web/.test(r[0])&&r.shift(),r.length){var o=r.pop(),a=s(H.web,r)[o]||s(x,r)[o];if(!m(a))throw Error("调用的方法 "+o+" 不存在");if(n){if(!(J in n)||"string"!=typeof n[J])return void a(n.value);var u=n[J];delete n[J];var p=a(n.value),c={};if("object"==("undefined"==typeof p?"undefined":g(p))&&p instanceof HTMLElement)throw Error("HTMLElement instance is not allowed to return to native.");c[P]=u,c.value=p,i(e.replace(/\//g,"."),c)}else a(t)}}function p(e,t){var n=B[e];if(!m(t))return!1;if(t.name||console.warn("绑定事件 "+e+" 请尽量不用匿名函数！"),n){if(I(n)||(n=[n]),I(n)&&~n.indexOf(t))return!1;n.push(t)}else n=t;return B[e]=n,!0}function c(e,t){if(!e)return void(H.debug&&console.warn("Receive empty event"));var n=B[e];return R!==e||n||(n=H.app.back.bind(null,0)),e in B||R===e?void(I(n)?n.forEach(function(e){e(t)}):m(n)&&n(t)):void console.warn("event %s has not emited",e)}function f(e,t){if(!(e in B))return!1;if(m(t)){var n=B[e];return I(n)?(B[e]=n.filter(function(e){return e!=t}),B[e].length!==n.length):n==t?delete B[e]:!1}return delete B[e]}function s(e,t){for(var n=0,r=void 0;r=t[n++];)!e[r]&&(e[r]={}),e=e[r];return e}function l(e,t,n,r){if(m(t)){var o=function(){e=e.replace(/\./g,"/");var o=T+Date.now(),i=U[e]||(U[e]={});return i[o]=function(e){var a=_.call(arguments);r?setTimeout(function(){t.apply(n,a)},0):t.apply(n,a),delete i[o]},{v:o}}();if("object"===("undefined"==typeof o?"undefined":g(o)))return o.v}return""}function d(e,t){return e=e.replace(/\./g,"/"),(U[e]||{})[t]}function v(e){if(H.isInApp&&!H.debug||console.info("Request url: %s\nOrigin url: %s",e,decodeURIComponent(e)),H.isInApp){var t=document.createElement("iframe");return document.body.appendChild(t),t.style.cssText="display:none;width:0px;height:0px;",t.src=e,setTimeout(function(){t.parentNode.removeChild(t)},0),!0}}function h(e,t){var n=arguments.length<=2||void 0===arguments[2]?H:arguments[2];"__defineGetter__"in n?n.__defineGetter__(e,function(){return m(t)?t():t}):n[e]=m(t)?t():t}function y(e){var t=[];for(var n in e){var r=e[n];"object"==("undefined"==typeof r?"undefined":g(r))&&(r=JSON.stringify(r)),t.push(n+"="+r)}return t.join("&")}function b(e,t){for(var n=0;n<t.length;n++)if(new RegExp(t[n]).test(e))return t[n].replace(/\s+/,"");return"Other"}function k(e){if(!e)return e;if(e=e.trim(),!/^http(''|s)?:\/\//.test(e)){var t=w(e);e=e.replace(/^(?:\.)?\//,""),e=t.protocol+"//"+t.host+"/"+e}return e}function w(e){var t=document.createElement("a");return t.href=e||"x.html",{protocol:t.protocol.replace(":",""),host:t.host,port:t.port,pathname:t.pathname,search:t.search,hash:t.hash}}function m(e){return"function"==typeof e}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},x=window,A=navigator.userAgent,_=Array.prototype.slice,I=Array.isArray,E=x.encodeURIComponent,S="HybridApp",j="HybridJS",O="hybrid",T="__t_",J="req_sn",P="res_sn",R="mback",U={},B={},H=x[j]={},M=A.match(new RegExp(S+"\\/([^\\/]+)\\/(\\d+)"));h("version","1.0.0"),h("desc","JavaScript layer for "+S+" hybrid framework."),h("device",function(){var e=A.match(/;\s*([^;]+)\s+Build/);return e?e[1]:"Unknown"}),h("os",b(A,[S,"Unknown"])),h("isInApp",H.os==S),h("appName",M?M[1]:""),h("appVersion",M?M[2]:0),H.debug=!1,H.web={},H.app={},h("wrapAPI",function(){return n}),h("assign",function(){return r}),h("invokeApp",function(){return i}),h("invokeWeb",function(){return a}),h("on",function(){return p}),h("off",function(){return f}),h("util",function(){return{serialize:y,resolveUrl:k,parseUrl:w}}),e.exports=H}])});